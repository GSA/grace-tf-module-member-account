version: 2
jobs:
  terraform:
    docker:
      - image: hashicorp/terraform
        environment:
          AWS_DEFAULT_REGION: us-east-1
    steps:
      - checkout
      - run:
          name: Set up Terraform
          command: cd terraform/modules/member_account && terraform init -backend=false
      - run:
          name: Validate Terraform
          command: cd terraform/modules/member_account && terraform validate -check-variables=false
      - run:
          name: Install python
          command: apt-get install python3
      - run:
          name: Install Terrascan
          command: pip install terrascan
      - run:
          name: Static Code Analysis with Terrascan
          command: terrascan -l terraform/modules/member_account

workflows:
  version: 2

  validate:
    jobs:
      - terraform
